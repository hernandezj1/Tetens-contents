<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TEI Viewer</title>
<style>
    body { font-family: sans-serif; padding: 10px; }
    #output { border:1px solid #ccc; padding:15px; margin-top:10px; }
</style>
</head>
<body>

<h1>TEI XML Viewer</h1>

<label>Select document:</label>
<select id="teiSelector"></select>

<div id="output">Choose a document...</div>

<script>
// ---- Load CSV into dropdown ----
fetch("data/files.csv")
    .then(res => res.text())
    .then(text => {
        const lines = text.trim().split("\n").slice(1);
        const select = document.getElementById("teiSelector");
        lines.forEach(line => {
            const [label, url] = line.split(",");
            const opt = document.createElement("option");
            opt.value = url.trim();
            opt.textContent = label.trim();
            select.appendChild(opt);
        });
    });

// ---- Trigger load and transform ----
document.getElementById("teiSelector").addEventListener("change", async () => {
    const url = event.target.value;
    if (!url) return;

    const xml = await (await fetch(url)).text();
    const xsl = await (await fetch("xslt/transform.xsl")).text();

    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xml, "text/xml");
    const xslDoc = parser.parseFromString(xsl, "text/xml");

    const processor = new XSLTProcessor();
    processor.importStylesheet(xslDoc);

    const output = processor.transformToFragment(xmlDoc, document);
    const container = document.getElementById("output");
    container.innerHTML = "";
    container.appendChild(output);
});
</script>

</body>
</html>
